#!/usr/bin/env bash
# see markdown file

set -Eeuo pipefail

# Bash lib library path detection
if [ "${BASHLIB_PATH:-}" == "" ]; then
  SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}" || echo "${BASH_SOURCE[0]}")")" && pwd)"
  # This is also a valid path for brew
  BASHLIB_PATH="$SCRIPT_DIR/../lib"
fi
export PATH="$BASHLIB_PATH:$PATH"

# shellcheck source=../..//bash-lib/lib/bashlib-error.sh
source "bashlib-error.sh"
error::set_strict_mode
error::set_trap
# shellcheck source=../..//bash-lib/lib/bashlib-doc.sh
source "bashlib-doc.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-git.sh
source "bashlib-git.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-string.sh
source "bashlib-string.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-path.sh
source "bashlib-path.sh"

function synopsis() {

  cat << EOF
\`\`\`bash
$(basename "$0") tags
\`\`\`
tags is one or more tags separated by space
EOF

}

# Doc Synopsis
if [ "${1:-}" = "synopsis" ]; then
  synopsis
  exit 0
fi

# Help
if [[ "${1:-}" =~ -h|--help|help ]]; then
  doc::help synopsis
  exit 0
fi

tags=${1}
for tag in $tags; do
  echo "Deleting tag: $tag"
  echo "  * locally"
  git tag -d "$tag"
  echo "  * remotely"
  git push origin --delete "$tag"
done
# Delete GitHub release if gh CLI is available
if command -v gh &> /dev/null; then
  echo "Checking for GitHub release: $tag"
  if gh release view "$tag" &> /dev/null; then
    echo "Deleting GitHub release: $tag"
    gh release delete "$tag" --yes
  else
    echo "No GitHub Release $tag found"
  fi
else
  echo "gh command not found, could not check and delete GitHub Release"
fi
